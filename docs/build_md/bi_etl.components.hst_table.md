### Navigation

-   [index](genindex.md "General Index")
-   [modules](py-modindex.md "Python Module Index") |
-   [next](bi_etl.components.readonlytable.md "bi_etl.components.readonlytable module") |
-   [previous](bi_etl.components.etlcomponent.md "bi_etl.components.etlcomponent module") |
-   [bi\_etl 0.5.3 documentation](index.md) »
-   [bi\_etl](modules.md) »
-   [bi\_etl package](bi_etl.md) »
-   [bi\_etl.components package](bi_etl.components.md) »

<span id="bi-etl-components-hst-table-module"></span>
bi\_etl.components.hst\_table module<a href="#module-bi_etl.components.hst_table" class="headerlink" title="Permalink to this headline">¶</a>
=============================================================================================================================================

Created on Nov 4, 2014

@author: woodd

 *class* `bi_etl.components.hst_table.``HistoryTable`<span class="sig-paren">(</span>*task*, *database*, *table\_name*, *table\_name\_case\_sensitive=False*, *exclude\_columns=None*, *\*\*kwargs*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable" class="headerlink" title="Permalink to this definition">¶</a>  
Bases: <a href="bi_etl.components.table.md#bi_etl.components.table.Table" class="reference internal" title="bi_etl.components.table.Table"><code class="xref py py-class docutils literal">bi_etl.components.table.Table</code></a>

ETL target component for a table that stores history of updates. Also usable as a source.

|             |                                                                                                                                                                                                                     |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **task** (<a href="bi_etl.scheduler.task.md#bi_etl.scheduler.task.ETLTask" class="reference internal" title="bi_etl.scheduler.task.ETLTask"><em>ETLTask</em></a>) – The instance to register in (if not None) 
  -   **database** (*bi\_etl.scheduler.task.Database*) – The database to find the table/view in.                                                                                                                       
  -   **table\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – The name of the table/view.                              
  -   **exclude\_columns** (*list*) – Optional. A list of columns to exclude from the table/view. These columns will not be included in SELECT, INSERT, or UPDATE statements.                                          |

 `auto_generate_key`<a href="#bi_etl.components.hst_table.HistoryTable.auto_generate_key" class="headerlink" title="Permalink to this definition">¶</a>  
*boolean* – Should the primary key be automatically generated by the insert/upsert process? If True, the process will get the current maximum value and then increment it with each insert.

 `autocommit`<a href="#bi_etl.components.hst_table.HistoryTable.autocommit" class="headerlink" title="Permalink to this definition">¶</a>  
*boolean* – Automatically commit after delete? Defaults to False.

 `begin_date`<a href="#bi_etl.components.hst_table.HistoryTable.begin_date" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – Name of the begin date field

 `end_date`<a href="#bi_etl.components.hst_table.HistoryTable.end_date" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – Name of the end date field

 `inserts_use_default_begin_date`<a href="#bi_etl.components.hst_table.HistoryTable.inserts_use_default_begin_date" class="headerlink" title="Permalink to this definition">¶</a>  
*boolean* – Should inserts use the default begin date instead of the effective date passed in? This allows records to match up in joins with other history tables where the effective date of the ‘primary’ might be before the first version effective date. Default = True

 `default_begin_date`<a href="#bi_etl.components.hst_table.HistoryTable.default_begin_date" class="headerlink" title="Permalink to this definition">¶</a>  
*date* – Default begin date to assign for begin\_date. Used for new records if inserts\_use\_default\_begin\_date is True. Also used for <a href="#bi_etl.components.hst_table.HistoryTable.get_missing_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_missing_row"><code class="xref py py-meth docutils literal">get_missing_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_invalid_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_invalid_row"><code class="xref py py-meth docutils literal">get_invalid_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_not_applicable_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_not_applicable_row"><code class="xref py py-meth docutils literal">get_not_applicable_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_various_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_various_row"><code class="xref py py-meth docutils literal">get_various_row()</code></a> Default = 1900-1-1

 `default_end_date`<a href="#bi_etl.components.hst_table.HistoryTable.default_end_date" class="headerlink" title="Permalink to this definition">¶</a>  
*date* – Default begin date to assign for end\_date for active rows. Also used for <a href="#bi_etl.components.hst_table.HistoryTable.get_missing_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_missing_row"><code class="xref py py-meth docutils literal">get_missing_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_invalid_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_invalid_row"><code class="xref py py-meth docutils literal">get_invalid_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_not_applicable_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_not_applicable_row"><code class="xref py py-meth docutils literal">get_not_applicable_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_various_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_various_row"><code class="xref py py-meth docutils literal">get_various_row()</code></a> Default = 9999-1-1

 `auto_generate_key`  
*boolean* – Should the primary key be automatically generated by the insert/upsert process? If True, the process will get the current maximum value and then increment it with each insert. (inherited from Table)

 `batch_size`<a href="#bi_etl.components.hst_table.HistoryTable.batch_size" class="headerlink" title="Permalink to this definition">¶</a>  
*int* – How many rows should be insert/update/deleted in a single batch. (inherited from Table)

 `delete_flag`<a href="#bi_etl.components.hst_table.HistoryTable.delete_flag" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – The name of the delete\_flag column, if any. Optional. (inherited from ReadOnlyTable)

 `delete_flag_yes`<a href="#bi_etl.components.hst_table.HistoryTable.delete_flag_yes" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – The value of delete\_flag for deleted rows. Optional. (inherited from ReadOnlyTable)

 `delete_flag_no`<a href="#bi_etl.components.hst_table.HistoryTable.delete_flag_no" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – The value of delete\_flag for *not* deleted rows. Optional. (inherited from ReadOnlyTable)

 `default_date_format`<a href="#bi_etl.components.hst_table.HistoryTable.default_date_format" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – The date parsing format to use for str -&gt; date conversions. If more than one date format exists in the source, then explicit conversions will be required.

Default = ‘%m/%d/%Y’ (inherited from Table)

 `force_ascii`<a href="#bi_etl.components.hst_table.HistoryTable.force_ascii" class="headerlink" title="Permalink to this definition">¶</a>  
*boolean* – Should text values be forced into the ascii character set before passing to the database? Default = False (inherited from Table)

 `last_update_date`<a href="#bi_etl.components.hst_table.HistoryTable.last_update_date" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – Name of the column which we should update when table updates are made. Default = None (inherited from Table)

 `log_first_row`<a href="#bi_etl.components.hst_table.HistoryTable.log_first_row" class="headerlink" title="Permalink to this definition">¶</a>  
*boolean* – Should we log progress on the the first row read. *Only applies if Table is used as a source.* (inherited from ETLComponent)

 `max_rows`<a href="#bi_etl.components.hst_table.HistoryTable.max_rows" class="headerlink" title="Permalink to this definition">¶</a>  
*int* – The maximum number of rows to read. *Only applies if Table is used as a source.* Optional. (inherited from ETLComponent)

 `primary_key`<a href="#bi_etl.components.hst_table.HistoryTable.primary_key" class="headerlink" title="Permalink to this definition">¶</a>  
*list* – The name of the primary key column(s). Only impacts trace messages. Default=None. If not passed in, will use the database value, if any. (inherited from ETLComponent)

 `natural_key`<a href="#bi_etl.components.hst_table.HistoryTable.natural_key" class="headerlink" title="Permalink to this definition">¶</a>  
*list* – The list of natural key columns (as Column objects). The default is the list of non-begin/end date primary key columns. The default is *not* appropriate for dimension tables with surrogate keys.

 `progress_frequency`<a href="#bi_etl.components.hst_table.HistoryTable.progress_frequency" class="headerlink" title="Permalink to this definition">¶</a>  
*int* – How often (in seconds) to output progress messages. Optional. (inherited from ETLComponent)

 `progress_message`<a href="#bi_etl.components.hst_table.HistoryTable.progress_message" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – The progress message to print. Optional. Default is `"{logical_name} row # {row_number}"`. Note `logical_name` and `row_number` substitutions applied via <a href="https://docs.python.org/2/library/functions.md#format" class="reference external" title="(in Python v2.7)"><code class="xref py py-func docutils literal">format()</code></a>. (inherited from ETLComponent)

 `special_values_descriptive_columns`<a href="#bi_etl.components.hst_table.HistoryTable.special_values_descriptive_columns" class="headerlink" title="Permalink to this definition">¶</a>  
*list* – A list of columns that get longer descriptive text in <a href="#bi_etl.components.hst_table.HistoryTable.get_missing_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_missing_row"><code class="xref py py-meth docutils literal">get_missing_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_invalid_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_invalid_row"><code class="xref py py-meth docutils literal">get_invalid_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_not_applicable_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_not_applicable_row"><code class="xref py py-meth docutils literal">get_not_applicable_row()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.get_various_row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_various_row"><code class="xref py py-meth docutils literal">get_various_row()</code></a> Optional. (inherited from ReadOnlyTable)

 `track_source_rows`<a href="#bi_etl.components.hst_table.HistoryTable.track_source_rows" class="headerlink" title="Permalink to this definition">¶</a>  
*boolean* – Should the <a href="#bi_etl.components.hst_table.HistoryTable.upsert" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.upsert"><code class="xref py py-meth docutils literal">upsert()</code></a> method keep a set container of source row keys that it has processed? That set would then be used by <a href="#bi_etl.components.hst_table.HistoryTable.update_not_processed" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.update_not_processed"><code class="xref py py-meth docutils literal">update_not_processed()</code></a>, <a href="#bi_etl.components.hst_table.HistoryTable.logically_delete_not_processed" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.logically_delete_not_processed"><code class="xref py py-meth docutils literal">logically_delete_not_processed()</code></a>, and <a href="#bi_etl.components.hst_table.HistoryTable.delete_not_processed" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.delete_not_processed"><code class="xref py py-meth docutils literal">delete_not_processed()</code></a>. (inherited from Table)

 `type_1_surrogate`<a href="#bi_etl.components.hst_table.HistoryTable.type_1_surrogate" class="headerlink" title="Permalink to this definition">¶</a>  
*str* – The name of the type 1 surrogate key. The value is automatically generated as equal to the type 2 key on inserts and equal to the existing value on updates. Optional.

 `DEFAULT_BATCH_SIZE` *= 5000*<a href="#bi_etl.components.hst_table.HistoryTable.DEFAULT_BATCH_SIZE" class="headerlink" title="Permalink to this definition">¶</a>  

 `DEFAULT_PROGRESS_FREQUENCY` *= 10*<a href="#bi_etl.components.hst_table.HistoryTable.DEFAULT_PROGRESS_FREQUENCY" class="headerlink" title="Permalink to this definition">¶</a>  

 `DEFAULT_PROGRESS_MESSAGE` *= '{logical\_name} current row \# {row\_number:,}'*<a href="#bi_etl.components.hst_table.HistoryTable.DEFAULT_PROGRESS_MESSAGE" class="headerlink" title="Permalink to this definition">¶</a>  

 `NAN_REPLACEMENT_VALUE` *= None*<a href="#bi_etl.components.hst_table.HistoryTable.NAN_REPLACEMENT_VALUE" class="headerlink" title="Permalink to this definition">¶</a>  

 `NK_LOOKUP` *= 'NK'*<a href="#bi_etl.components.hst_table.HistoryTable.NK_LOOKUP" class="headerlink" title="Permalink to this definition">¶</a>  

 `PK_LOOKUP` *= 'PK'*<a href="#bi_etl.components.hst_table.HistoryTable.PK_LOOKUP" class="headerlink" title="Permalink to this definition">¶</a>  

 `Row`<span class="sig-paren">(</span>*data=None*, *logical\_name=None*, *iteration\_header=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.Row" class="headerlink" title="Permalink to this definition">¶</a>  
Make a new empty row with this components structure.

 `add_stats_entry`<span class="sig-paren">(</span>*stats\_id*, *stats\_entry*, *parent\_stats=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.add_stats_entry" class="headerlink" title="Permalink to this definition">¶</a>  

 `apply_updates`<span class="sig-paren">(</span>*row*, *changes\_list=None*, *additional\_update\_values=None*, *source\_effective\_date=None*, *stat\_name=None*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.apply_updates" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.apply_updates" class="headerlink" title="Permalink to this definition">¶</a>  

 `autogenerate_key`<span class="sig-paren">(</span>*row*, *force\_override=True*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.autogenerate_key" class="headerlink" title="Permalink to this definition">¶</a>  

 `autogenerate_sequence`<span class="sig-paren">(</span>*row*, *seq\_column: str*, *force\_override=True*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.autogenerate_sequence" class="headerlink" title="Permalink to this definition">¶</a>  

 `batch_size`  

 `begin`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.begin" class="headerlink" title="Permalink to this definition">¶</a>  

 `begin_date`  

 `build_nk`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.build_nk" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.build_nk" class="headerlink" title="Permalink to this definition">¶</a>  

 `build_row`<span class="sig-paren">(</span>*source\_row: bi\_etl.components.row.row.Row*, *additional\_values: dict = None*, *source\_excludes: typing.Iterable = None*, *target\_excludes: typing.Iterable = None*, *stat\_name: str = 'build rows'*, *parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span> → bi\_etl.components.row.row.Row<a href="#bi_etl.components.hst_table.HistoryTable.build_row" class="headerlink" title="Permalink to this definition">¶</a>  
Use a source row to build a row with correct data types for this table.

|              |                                                                                                                                    |
|--------------|------------------------------------------------------------------------------------------------------------------------------------|
| Parameters:  | -   **source\_row** –                                                                                                              
  -   **additional\_values** –                                                                                                        
  -   **source\_excludes** –                                                                                                          
  -   **target\_excludes** –                                                                                                          
  -   **stat\_name** – Name of this step for the ETLTask statistics. Default = ‘upsert\_by\_pk’                                       
  -   **parent\_stats** –                                                                                                             |
| Returns:     |                                                                                                                                    |
| Return type: | <a href="bi_etl.components.row.md#module-bi_etl.components.row" class="reference internal" title="bi_etl.components.row">row</a> |

 `cache_commit`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.cache_commit" class="headerlink" title="Permalink to this definition">¶</a>  

 `cache_row`<span class="sig-paren">(</span>*row*, *allow\_update=False*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.cache_row" class="headerlink" title="Permalink to this definition">¶</a>  

 `check_row_limit`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.check_row_limit" class="headerlink" title="Permalink to this definition">¶</a>  

 `cleanup_spurious_versions`<span class="sig-paren">(</span>*remove\_spurious\_deletes=False*, *remove\_redundant\_versions=None*, *lookup\_name=None*, *exclude\_from\_compare=None*, *filter\_criteria=None*, *use\_cache\_as\_source=True*, *repeat\_until\_clean=True*, *max\_end\_date\_warnings: int = 100*, *parent\_stats=None*, *progress\_message='{table} cleanup\_spurious\_versions pass {pass\_number} current row \# {row\_number:*, *}'*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.cleanup_spurious_versions" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.cleanup_spurious_versions" class="headerlink" title="Permalink to this definition">¶</a>  
This routine will look for and remove versions where no material difference exists between it and the prior version. That can happen during loads if rows come in out of order. The routine can also optionally look for remove\_spurious\_deletes (see below). It also checks for version dates that are not set correctly.

Todo

Rename to cleanup\_versions since it does optionally numerous cleanups.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **remove\_spurious\_deletes** (*boolean*) – (defaults to False): Should the routine check for and remove versions that tag a record as being deleted only to be un-deleted later.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  -   **remove\_redundant\_versions** (*boolean*) –                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      (defaults to opposite of auto\_generate\_key value): Should the routine delete rows that are exactly                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      the same as the previous.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -   **lookup\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name passed into <a href="#bi_etl.components.hst_table.HistoryTable.define_lookup" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.define_lookup"><code class="xref py py-meth docutils literal">define_lookup()</code></a>                                                                                                                                                                                                                                                    
  -   **filter\_criteria** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a> *or* *list of strings*) – Only rows matching criteria will be checked against the `list_of_key_tuples` for deletion. Each string value will be passed to `sqlalchemy.sql.expression.Select.where()`. <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>  
  -   **exclude\_from\_compare** (*list*) – Columns to exclude from comparisons. Defaults to begin date, end date, and last update date. Any values passed in are added to that list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -   **use\_cache\_as\_source** (<a href="https://docs.python.org/2/library/functions.md#bool" class="reference external" title="(in Python v2.7)"><em>bool</em></a>) – Attempt to read existing rows from the cache?                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  -   **repeat\_until\_clean** – repeat loop until all issues are cleaned. Multiple bad rows in a key set can require multiple passes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  -   **max\_end\_date\_warnings** – How many warning messages to print about bad dates                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                                                                                                                                                                                                                                         
  -   **progress\_message** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – The progress message to print.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

 `clear_cache`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.clear_cache" class="headerlink" title="Permalink to this definition">¶</a>  
Clear all lookup caches. Sets to un-cached state (unknown state v.s. empty state which is what init\_cache gives)

 `clear_statistics`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.clear_statistics" class="headerlink" title="Permalink to this definition">¶</a>  

 `close`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.close" class="headerlink" title="Permalink to this definition">¶</a>  

 `column_names`<a href="#bi_etl.components.hst_table.HistoryTable.column_names" class="headerlink" title="Permalink to this definition">¶</a>  
Column names

 `columns`<a href="#bi_etl.components.hst_table.HistoryTable.columns" class="headerlink" title="Permalink to this definition">¶</a>  
A named-based collection of `sqlalchemy.sql.expression.ColumnElement` objects in this table/view.

 `commit`<span class="sig-paren">(</span>*stat\_name='commit'*, *parent\_stats=None*, *print\_to\_log=True*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.commit" class="headerlink" title="Permalink to this definition">¶</a>  
Flush any buffered deletes, updates, or inserts

|             |                                                                                                                                                                                                                                                                                                                                |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **stat\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name of this step for the ETLTask statistics. Default = ‘commit’                                                                                                    
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.  
  -   **print\_to\_log** (<a href="https://docs.python.org/2/library/functions.md#bool" class="reference external" title="(in Python v2.7)"><em>bool</em></a>) – Should this add a debug log entry for each commit. Defaults to true.                                                                                           |

 `connection`<span class="sig-paren">(</span><span class="sig-paren">)</span> → sqlalchemy.engine.base.Connection<a href="#bi_etl.components.hst_table.HistoryTable.connection" class="headerlink" title="Permalink to this definition">¶</a>  

 `debug_log`<span class="sig-paren">(</span>*state=True*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.debug_log" class="headerlink" title="Permalink to this definition">¶</a>  

 `define_lookup`<span class="sig-paren">(</span>*lookup\_name*, *lookup\_keys*, *lookup\_class=None*, *lookup\_class\_kwargs=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.define_lookup" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.define_lookup" class="headerlink" title="Permalink to this definition">¶</a>  
Define a new lookup.

|             |                                                                                                                                                                                                                                                                                                                         |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **lookup\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name for the lookup. Used to refer to it later.                                                                                                            
  -   **lookup\_keys** (*list*) – list of lookup key columns                                                                                                                                                                                                                                                               
  -   **lookup\_class** (*Class*) – Optional python class to use for the lookup. Defaults to value of default\_lookup\_class attribute.                                                                                                                                                                                    
  -   **lookup\_class\_kwargs** (<a href="https://docs.python.org/2/library/stdtypes.md#dict" class="reference external" title="(in Python v2.7)"><em>dict</em></a>) – Optional dict of additional parameters to pass to lookup constructor. Defaults to empty dict. begin\_date and end\_date are added automatically.  |

 `delete`<span class="sig-paren">(</span>*\*\*kwargs*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.delete" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.delete" class="headerlink" title="Permalink to this definition">¶</a>  
Not implemented for history table. Instead use physically\_delete\_version.

 `delete_flag`  

 `delete_not_in_set`<span class="sig-paren">(</span>*set\_of\_key\_tuples*, *source\_effective\_date=None*, *lookup\_name=None*, *criteria=None*, *stat\_name='delete\_not\_in\_set'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.delete_not_in_set" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.delete_not_in_set" class="headerlink" title="Permalink to this definition">¶</a>  
Overridden to call logical delete.

 `delete_not_processed`<span class="sig-paren">(</span>*source\_effective\_date=None, criteria: typing.Union\[typing.Iterable\[str\], str\] = None, use\_cache\_as\_source: bool = True, parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.delete_not_processed" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.delete_not_processed" class="headerlink" title="Permalink to this definition">¶</a>  
Overridden to call logical delete.

 `end_date`  

 `ensure_nk_lookup`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.ensure_nk_lookup" class="headerlink" title="Permalink to this definition">¶</a>  

 `exclude_columns`<span class="sig-paren">(</span>*columns\_to\_exclude*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.exclude_columns" class="headerlink" title="Permalink to this definition">¶</a>  
Exclude columns from the table. Removes them from all SQL statements.

columns\_to\_exclude <span class="classifier-delimiter">:</span> <span class="classifier">list</span>  
A list of columns to exclude when reading the table/view.

 `execute`<span class="sig-paren">(</span>*statement*, *\*multiparams*, *\*\*params*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.execute" class="headerlink" title="Permalink to this definition">¶</a>  

 `fill_cache`<span class="sig-paren">(</span>*progress\_frequency=10*, *progress\_message='{table} fill\_cache current row \# {row\_number:*, *}'*, *criteria=None*, *column\_list=None*, *exclude\_cols=None*, *order\_by=None*, *assume\_lookup\_complete=None*, *row\_limit=None*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.fill_cache" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.fill_cache" class="headerlink" title="Permalink to this definition">¶</a>  
Fill all lookup caches from the table.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **column\_list** (*list*) – Optional. Specific columns to include when filling the cache.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  -   **exclude\_cols** (*list*) – Optional. Columns to exclude from the cached rows.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  -   **progress\_frequency** (<a href="https://docs.python.org/2/library/functions.md#int" class="reference external" title="(in Python v2.7)"><em>int</em></a>) – How often (in seconds) to output progress messages. Default 10. None for no progress messages. Optional.                                                                                                                                                                                                                                                                                        
  -   **progress\_message** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – The progress message to print. Default is `"{table} fill_cache current row # {row_number:,}"`. Note `logical_name` and `row_number` substitutions applied via <a href="https://docs.python.org/2/library/functions.md#format" class="reference external" title="(in Python v2.7)"><code class="xref py py-func docutils literal">format()</code></a>. Optional.                                 
  -   **criteria** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a> *or* *list of strings*) – Each string value will be passed to `sqlalchemy.sql.expression.Select.where()`. <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>  
  -   **assume\_lookup\_complete** (*boolean*) – Should later lookup calls assume the cache is complete (and thus raise an Exception if a key combination is not found)? Default to False if filtering criteria was used, otherwise defaults to True.                                                                                                                                                                                                                                                                                                                 
  -   **row\_limit** (<a href="https://docs.python.org/2/library/functions.md#int" class="reference external" title="(in Python v2.7)"><em>int</em></a>) – limit on number of rows to cache.                                                                                                                                                                                                                                                                                                                                                                        
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                                                                                                                                      
  -   **order\_by** (*list*) – Columns to order by when pulling data. Sometimes required to build the cache corretly.                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

 `generate_iteration_header`<span class="sig-paren">(</span>*logical\_name=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.generate_iteration_header" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_by_key`<span class="sig-paren">(</span>*source\_row: bi\_etl.components.row.row.Row*, *stats\_id: str = 'get\_by\_key'*, *parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span> → bi\_etl.components.row.row.Row<a href="#bi_etl.components.hst_table.HistoryTable.get_by_key" class="headerlink" title="Permalink to this definition">¶</a>  
Get by the primary key.

 `get_by_lookup`<span class="sig-paren">(</span>*lookup\_name*, *source\_row*, *stats\_id='get\_by\_lookup'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.get_by_lookup" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.get_by_lookup" class="headerlink" title="Permalink to this definition">¶</a>  
Get by an alternate key. Returns a row.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **lookup\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name passed into <a href="#bi_etl.components.hst_table.HistoryTable.define_lookup" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.define_lookup"><code class="xref py py-meth docutils literal">define_lookup()</code></a> 
  -   **source\_row** (`Row`) – Row to get lookup keys from (including effective date)                                                                                                                                                                                                                                                                                                                                 
  -   **stats\_id** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Statistics name to use                                                                                                                                                                                                                                     
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                       |
| Raises:     | -   NoResultFound: – If key doesn’t exist.                                                                                                                                                                                                                                                                                                                                                                          
  -   BeforeAllExisting: – If the effective date provided is before all existing records.                                                                                                                                                                                                                                                                                                                              |

 `get_by_lookup_and_effective_date`<span class="sig-paren">(</span>*lookup\_name*, *source\_row*, *effective\_date*, *stats\_id='get\_by\_lookup\_and\_effective\_date'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.get_by_lookup_and_effective_date" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.get_by_lookup_and_effective_date" class="headerlink" title="Permalink to this definition">¶</a>  
Get by an alternate key. Returns a row.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **lookup\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name passed into <a href="#bi_etl.components.hst_table.HistoryTable.define_lookup" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.define_lookup"><code class="xref py py-meth docutils literal">define_lookup()</code></a> 
  -   **source\_row** (`Row`) – `Row` to get lookup keys from                                                                                                                                                                                                                                                                                                                                                          
  -   **effective\_date** (*date*) – Effective date to use for lookup                                                                                                                                                                                                                                                                                                                                                  
  -   **stats\_id** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Statistics name to use                                                                                                                                                                                                                                     
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                       |
| Raises:     | -   NoResultFound: – If key doesn’t exist.                                                                                                                                                                                                                                                                                                                                                                          
  -   BeforeAllExisting: – If the effective date provided is before all existing records.                                                                                                                                                                                                                                                                                                                              |

 `get_column`<span class="sig-paren">(</span>*column: typing.Union\[str, sqlalchemy.sql.schema.Column\]*<span class="sig-paren">)</span> → sqlalchemy.sql.schema.Column<a href="#bi_etl.components.hst_table.HistoryTable.get_column" class="headerlink" title="Permalink to this definition">¶</a>  
Get the `sqlalchemy.sql.expression.ColumnElement` object for a given column name.

 `get_column_name`<span class="sig-paren">(</span>*column*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_column_name" class="headerlink" title="Permalink to this definition">¶</a>  
Get the column name given a possible `sqlalchemy.sql.expression.ColumnElement` object.

 `get_invalid_row`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_invalid_row" class="headerlink" title="Permalink to this definition">¶</a>  
Get a `Row` with the Invalid special values filled in for all columns.

<table>
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Integer</td>
<td>-8888</td>
</tr>
<tr class="even">
<td>Short Text</td>
<td>‘!’</td>
</tr>
<tr class="odd">
<td>Long Text</td>
<td>‘Invalid’</td>
</tr>
<tr class="even">
<td>Date</td>
<td>9999-8-1</td>
</tr>
</tbody>
</table>

 `get_lookup`<span class="sig-paren">(</span>*lookup\_name*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_lookup" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_lookup_keys`<span class="sig-paren">(</span>*lookup\_name*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_lookup_keys" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_lookup_tuple`<span class="sig-paren">(</span>*lookup\_name*, *row*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_lookup_tuple" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_missing_row`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_missing_row" class="headerlink" title="Permalink to this definition">¶</a>  
Get a `Row` with the Missing special values filled in for all columns.

<table>
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Integer</td>
<td>-9999</td>
</tr>
<tr class="even">
<td>Short Text</td>
<td>‘?’</td>
</tr>
<tr class="odd">
<td>Long Text</td>
<td>‘Missing’</td>
</tr>
<tr class="even">
<td>Date</td>
<td>9999-9-1</td>
</tr>
</tbody>
</table>

 `get_natural_key_tuple`<span class="sig-paren">(</span>*row*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_natural_key_tuple" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_natural_key_value_list`<span class="sig-paren">(</span>*row*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_natural_key_value_list" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_nk_lookup`<span class="sig-paren">(</span><span class="sig-paren">)</span> → bi\_etl.lookups.lookup.Lookup<a href="#bi_etl.components.hst_table.HistoryTable.get_nk_lookup" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_nk_lookup_name`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_nk_lookup_name" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_not_applicable_row`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_not_applicable_row" class="headerlink" title="Permalink to this definition">¶</a>  
Get a `Row` with the Not Applicable special values filled in for all columns.

<table>
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Integer</td>
<td>-7777</td>
</tr>
<tr class="even">
<td>Short Text</td>
<td>‘~’</td>
</tr>
<tr class="odd">
<td>Long Text</td>
<td>‘Not Applicable’</td>
</tr>
<tr class="even">
<td>Date</td>
<td>9999-7-1</td>
</tr>
</tbody>
</table>

 `get_one`<span class="sig-paren">(</span>*statement=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_one" class="headerlink" title="Permalink to this definition">¶</a>  
Gets one row from the statement.

|              |                                                              |
|--------------|--------------------------------------------------------------|
| Returns:     | **row** – The row returned                                   |
| Return type: | `Row`                                                        |
| Raises:      | -   `NoResultFound` – No rows returned.                      
  -   `MultipleResultsFound` – More than one row was returned.  |

 `get_pk_lookup`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_pk_lookup" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_primary_key_value_list`<span class="sig-paren">(</span>*row*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_primary_key_value_list" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_primary_key_value_tuple`<span class="sig-paren">(</span>*row*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_primary_key_value_tuple" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_special_row`<span class="sig-paren">(</span>*short\_char*, *long\_char*, *int\_value*, *date\_value*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_special_row" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_stats_entry`<span class="sig-paren">(</span>*stats\_id: str*, *parent\_stats: bi\_etl.statistics.Statistics = None*, *print\_start\_stop\_times: bool = None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_stats_entry" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_unique_stats_entry`<span class="sig-paren">(</span>*stats\_id*, *parent\_stats=None*, *print\_start\_stop\_times=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_unique_stats_entry" class="headerlink" title="Permalink to this definition">¶</a>  

 `get_various_row`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.get_various_row" class="headerlink" title="Permalink to this definition">¶</a>  
Get a `Row` with the Various special values filled in for all columns.

<table>
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Integer</td>
<td>-6666</td>
</tr>
<tr class="even">
<td>Short Text</td>
<td>‘*’</td>
</tr>
<tr class="odd">
<td>Long Text</td>
<td>‘Various’</td>
</tr>
<tr class="even">
<td>Date</td>
<td>9999-6-1</td>
</tr>
</tbody>
</table>

 `include_only_columns`<span class="sig-paren">(</span>*columns\_to\_include*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.include_only_columns" class="headerlink" title="Permalink to this definition">¶</a>  
Include only specified columns in the table defintion. Columns that are non included are removed them from all SQL statements.

columns\_to\_include <span class="classifier-delimiter">:</span> <span class="classifier">list</span>  
A list of columns to include when reading the table/view.

 `init_cache`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.init_cache" class="headerlink" title="Permalink to this definition">¶</a>  
Initialize all lookup caches as empty.

 `insert`<span class="sig-paren">(</span>*source\_row*, *additional\_insert\_values=None*, *source\_renames=None*, *source\_excludes=None*, *target\_excludes=None*, *source\_transformations=None*, *parent\_stats=None*, *\*\*kwargs*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.insert" class="headerlink" title="Permalink to this definition">¶</a>  
Insert a row or list of rows in the table.

|             |                                                                                                                                                                                                                                                                                                                                                                           |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **source\_row** (<a href="#bi_etl.components.hst_table.HistoryTable.Row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.Row"><code class="xref py py-class docutils literal">Row</code></a> or list thereof) – Row(s) to insert                                                                                                           
  -   **additional\_insert\_values** (<a href="https://docs.python.org/2/library/stdtypes.md#dict" class="reference external" title="(in Python v2.7)"><em>dict</em></a>) – Additional values to set on each row.                                                                                                                                                          
  -   **source\_renames** (<a href="https://docs.python.org/2/library/stdtypes.md#dict" class="reference external" title="(in Python v2.7)"><em>dict</em></a>) – Renames to apply to the columns in row(s).                                                                                                                                                                
  -   **source\_excludes** – list of Row source columns to exclude when mapping to this Table.                                                                                                                                                                                                                                                                               
  -   **target\_excludes** – list of Table columns to exclude when mapping from the source Row(s)                                                                                                                                                                                                                                                                            
  -   **source\_transformations** (<a href="https://docs.python.org/2/library/stdtypes.md#dict" class="reference external" title="(in Python v2.7)"><em>dict</em></a> *or* *iterable container*) – Container with (transform\_col, transform) mappings. See <a href="source_transformations.md" class="reference internal"><span class="doc">Transformations</span></a>  
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                             |

 `insert_row`<span class="sig-paren">(</span>*source\_row: bi\_etl.components.row.row.Row*, *additional\_insert\_values: dict = None*, *build\_method: str = 'safe'*, *source\_excludes: list = None*, *target\_excludes: list = None*, *stat\_name: str = 'insert'*, *parent\_stats: bi\_etl.statistics.Statistics = None*, *source\_effective\_date: datetime.datetime = None*<span class="sig-paren">)</span> → bi\_etl.components.row.row.Row<a href="_modules/bi_etl/components/hst_table.md#HistoryTable.insert_row" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.insert_row" class="headerlink" title="Permalink to this definition">¶</a>  
Inserts a row into the database (batching rows as batch\_size)

|              |                                                                                                                                                                                                         |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters:  | -   **source\_row** – The row with values to insert                                                                                                                                                     
  -   **additional\_insert\_values** –                                                                                                                                                                     
  -   **build\_method** – ‘safe’ matches source to tagret column by column. ‘clone’ makes a clone of the source row. Prevents possible issues with outside changes to the row. ‘none’ uses the row as is.  
  -   **source\_excludes** – list of source columns to exclude                                                                                                                                             
  -   **target\_excludes** – list of target columns to exclude                                                                                                                                             
  -   **stat\_name** –                                                                                                                                                                                     
  -   **parent\_stats** –                                                                                                                                                                                  
  -   **source\_effective\_date** –                                                                                                                                                                        |
| Returns:     |                                                                                                                                                                                                         |
| Return type: | new\_row                                                                                                                                                                                                |

 `is_connected`<span class="sig-paren">(</span><span class="sig-paren">)</span> → bool<a href="#bi_etl.components.hst_table.HistoryTable.is_connected" class="headerlink" title="Permalink to this definition">¶</a>  

 `is_date_key_column`<span class="sig-paren">(</span>*column*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.is_date_key_column" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.is_date_key_column" class="headerlink" title="Permalink to this definition">¶</a>  

 `iter_result`<span class="sig-paren">(</span>*result\_list: object*, *where\_dict: dict = None*, *progress\_frequency: int = None*, *stats\_id: str = None*, *parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span> → typing.Iterable\[bi\_etl.components.row.row.Row\]<a href="#bi_etl.components.hst_table.HistoryTable.iter_result" class="headerlink" title="Permalink to this definition">¶</a>  
|         |                            |
|---------|----------------------------|
| Yields: | **row** (`Row`) – next row |

 `log_progress`<span class="sig-paren">(</span>*row: bi\_etl.components.row.row.Row*, *stats*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.log_progress" class="headerlink" title="Permalink to this definition">¶</a>  

 `logically_delete_not_in_set`<span class="sig-paren">(</span>*set\_of\_key\_tuples: set, lookup\_name: str = None, criteria: typing.Union\[typing.Iterable\[str\], str\] = None, use\_cache\_as\_source: bool = True, source\_effective\_date=None, stat\_name: str = 'logically\_delete\_not\_in\_set', progress\_frequency: int = 10, parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.logically_delete_not_in_set" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.logically_delete_not_in_set" class="headerlink" title="Permalink to this definition">¶</a>  
Logically deletes rows matching criteria that are not in the list\_of\_key\_tuples pass in.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **set\_of\_key\_tuples** (*list*) – List of tuples comprising the primary key values. This list represents the rows that should *not* be logically deleted.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  -   **lookup\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name of the lookup to use                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -   **criteria** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a> *or* *list of strings*) – Only rows matching criteria will be checked against the `list_of_key_tuples` for deletion. Each string value will be passed to `sqlalchemy.sql.expression.Select.where()`. <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>  
  -   **use\_cache\_as\_source** (<a href="https://docs.python.org/2/library/functions.md#bool" class="reference external" title="(in Python v2.7)"><em>bool</em></a>) – Attempt to read existing rows from the cache?                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -   **stat\_name** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a>) – Name of this step for the ETLTask statistics. Default = ‘delete\_not\_in\_set’                                                                                                                                                                                                                                                                                                                                                                                                            
  -   **progress\_frequency** (<a href="https://docs.python.org/2/library/functions.md#int" class="reference external" title="(in Python v2.7)"><em>int</em></a>) – How often (in seconds) to output progress messages. Default = 10. None for no progress messages.                                                                                                                                                                                                                                                                                                                                                                                           
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                                                                                                                                                                                                                                 |

 `logically_delete_not_in_source`<span class="sig-paren">(</span>*source: bi\_etl.components.readonlytable.ReadOnlyTable, source\_criteria: typing.Union\[typing.Iterable\[str\], str\] = None, target\_criteria: typing.Union\[typing.Iterable\[str\], str\] = None, use\_cache\_as\_source: bool = True, parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.logically_delete_not_in_source" class="headerlink" title="Permalink to this definition">¶</a>  
Logically deletes rows matching criteria that are not in the source component passed to this method. The primary use case for this method is when the upsert method is only passed new/changed records and so cannot build a complete set of source keys in source\_keys\_processed.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **source** – The source to read to get the source keys.                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -   **source\_criteria** – Only source rows matching criteria will added to the list of keys not to logically delete. Each string value will be passed to `sqlalchemy.sql.expression.Select.where()`. <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>        
  -   **target\_criteria** – Only target rows matching criteria will be checked against the source keys for logical deletion. Each string value will be passed to `sqlalchemy.sql.expression.Select.where()`. <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>  
  -   **use\_cache\_as\_source** (<a href="https://docs.python.org/2/library/functions.md#bool" class="reference external" title="(in Python v2.7)"><em>bool</em></a>) – Attempt to read existing rows from the cache?                                                                                                                                                                                                                                                                                
  -   **parent\_stats** – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                                                                                                                                                                                                                                                  |

 `logically_delete_not_processed`<span class="sig-paren">(</span>*source\_effective\_date=None*, *criteria: list = None*, *use\_cache\_as\_source: bool = True*, *stat\_name='logically\_delete\_not\_processed'*, *parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.logically_delete_not_processed" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.logically_delete_not_processed" class="headerlink" title="Permalink to this definition">¶</a>  
Logically deletes rows matching criteria that are not in the Table memory of rows passed to <a href="#bi_etl.components.hst_table.HistoryTable.upsert" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.upsert"><code class="xref py py-meth docutils literal">upsert()</code></a>.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **source\_effective\_date** (*date*) – Effective date of records to logically delete                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -   **criteria** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a> *or* *list of strings*) – Only rows matching criteria will be checked against the `list_of_key_tuples` for logical deletion. Each string value will be passed to `sqlalchemy.sql.expression.Select.where()`. <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>  
  -   **use\_cache\_as\_source** (<a href="https://docs.python.org/2/library/functions.md#bool" class="reference external" title="(in Python v2.7)"><em>bool</em></a>) – Attempt to read existing rows from the cache?                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                                                                                                                                                                                                                                         
  -   **stat\_name** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a>) – Name of this step for the ETLTask statistics. Default = ‘logically\_delete\_not\_processed’                                                                                                                                                                                                                                                                                                                                                                                                       |

 `lookups`<a href="#bi_etl.components.hst_table.HistoryTable.lookups" class="headerlink" title="Permalink to this definition">¶</a>  

 `max`<span class="sig-paren">(</span>*column*, *where=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.max" class="headerlink" title="Permalink to this definition">¶</a>  
Query the table/view to get the maximum value of a given column.

|              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters:  | -   **column** (str or `sqlalchemy.sql.expression.ColumnElement`.) – The column to get the max value of                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -   **where** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a> *or* *list of strings*) – Each string value will be passed to `sqlalchemy.sql.expression.Select.where()` <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>  |
| Returns:     | **max**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Return type: | depends on column datatype                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

 `natural_key`  
Get this tables natural key

 `order_by`<span class="sig-paren">(</span>*order\_by*, *stats\_id=None*, *parent\_stats=None*<span class="sig-paren">)</span> → typing.Iterable\[bi\_etl.components.row.row.Row\]<a href="#bi_etl.components.hst_table.HistoryTable.order_by" class="headerlink" title="Permalink to this definition">¶</a>  
Iterate over rows matching `criteria`

|             |                                                                                                                                                                                                                                                                                                                                |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **order\_by** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a> *or* *list of strings*) – Each value should represent a column to order by.                                                                                   
  -   **stats\_id** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a>) – Name of this step for the ETLTask statistics.                                                                                                               
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.  |
| Yields:     | **row** (`Row`) – `Row` object with contents of a table/view row                                                                                                                                                                                                                                                               |

 `physically_delete_version`<span class="sig-paren">(</span>*row\_to\_be\_deleted*, *remove\_from\_cache=True*, *prior\_row=None*, *stat\_name='delete\_version'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.physically_delete_version" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.physically_delete_version" class="headerlink" title="Permalink to this definition">¶</a>  
**Physically** delete a given version row. Corrects the preceding end date value.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **row\_to\_be\_deleted** (`Row`) – Expected to be an entire existing row.                                                                                                                                                                                                                                                                                                                                                                             
  -   **remove\_from\_cache** (*boolean*) –                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      Optional. Remove the row from the cache?                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      Default = True                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -   **prior\_row** (*bi\_etl.components.row.row\_case\_insensitive.Row*) – Optional. The prior row, if already available. If None, it will be obtained via <a href="#bi_etl.components.hst_table.HistoryTable.get_by_lookup_and_effective_date" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.get_by_lookup_and_effective_date"><code class="xref py py-meth docutils literal">get_by_lookup_and_effective_date()</code></a>  
  -   **stat\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name of this step for the ETLTask statistics. Default = ‘delete\_version’                                                                                                                                                                                                                       
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional. Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                            |

 `primary_key`  

 `process_messages`<span class="sig-paren">(</span><span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.process_messages" class="headerlink" title="Permalink to this definition">¶</a>  
Processes messages for this components task. Should be called somewhere in any row looping. The standard iterator does this for you.

 `progress_frequency`  

 `rollback`<span class="sig-paren">(</span>*stat\_name='rollback'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.rollback" class="headerlink" title="Permalink to this definition">¶</a>  
Rollback any uncommitted deletes, updates, or inserts.

|             |                                                                                                                                                                                                                                                                                                                                |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **stat\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name of this step for the ETLTask statistics. Default = ‘rollback’                                                                                                  
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.  |

 `row_name`<a href="#bi_etl.components.hst_table.HistoryTable.row_name" class="headerlink" title="Permalink to this definition">¶</a>  

 `rows_read`<a href="#bi_etl.components.hst_table.HistoryTable.rows_read" class="headerlink" title="Permalink to this definition">¶</a>  
int The number of rows read and returned.

 `sanity_check_example_row`<span class="sig-paren">(</span>*example\_source\_row*, *source\_excludes=None*, *target\_excludes=None*, *ignore\_source\_not\_in\_target=None*, *ignore\_target\_not\_in\_source=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.sanity_check_example_row" class="headerlink" title="Permalink to this definition">¶</a>  

 `sanity_check_source_mapping`<span class="sig-paren">(</span>*source\_definition*, *source\_name=None*, *source\_excludes=None*, *target\_excludes=None*, *ignore\_source\_not\_in\_target=None*, *ignore\_target\_not\_in\_source=None*, *raise\_on\_source\_not\_in\_target=None*, *raise\_on\_target\_not\_in\_source=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.sanity_check_source_mapping" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.sanity_check_source_mapping" class="headerlink" title="Permalink to this definition">¶</a>  

 `select`<span class="sig-paren">(</span>*column\_list: typing.Union\[list*, *NoneType\] = None*, *exclude\_cols: typing.Union\[set*, *NoneType\] = None*<span class="sig-paren">)</span> → sqlalchemy.sql.selectable.Select<a href="#bi_etl.components.hst_table.HistoryTable.select" class="headerlink" title="Permalink to this definition">¶</a>  
Builds a select statement for this table.

|              |           |
|--------------|-----------|
| Returns:     |           |
| Return type: | statement |

 `set_kwattrs`<span class="sig-paren">(</span>*\*\*kwargs*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.set_kwattrs" class="headerlink" title="Permalink to this definition">¶</a>  

 `statistics`<a href="#bi_etl.components.hst_table.HistoryTable.statistics" class="headerlink" title="Permalink to this definition">¶</a>  

 `table`<a href="#bi_etl.components.hst_table.HistoryTable.table" class="headerlink" title="Permalink to this definition">¶</a>  

 `table_name`<a href="#bi_etl.components.hst_table.HistoryTable.table_name" class="headerlink" title="Permalink to this definition">¶</a>  
The table name

 `trace_data`<a href="#bi_etl.components.hst_table.HistoryTable.trace_data" class="headerlink" title="Permalink to this definition">¶</a>  
boolean Should a debug message be printed with the parsed contents (as columns) of each row.

 `truncate`<span class="sig-paren">(</span>*timeout=60*, *stat\_name='truncate'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.truncate" class="headerlink" title="Permalink to this definition">¶</a>  
Truncate the table if possible, else delete all.

|             |                                                                                                                                                                                                                                                                                                                                |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **timeout** (<a href="https://docs.python.org/2/library/functions.md#int" class="reference external" title="(in Python v2.7)"><em>int</em></a>) – How long in seconds to wait for the truncate. Oracle only.                                                                                                             
  -   **stat\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name of this step for the ETLTask statistics. Default = ‘truncate’                                                                                                   
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.  |

 `uncache_row`<span class="sig-paren">(</span>*row*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.uncache_row" class="headerlink" title="Permalink to this definition">¶</a>  

 `uncache_where`<span class="sig-paren">(</span>*key\_names*, *key\_values\_dict*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.uncache_where" class="headerlink" title="Permalink to this definition">¶</a>  

 `update`<span class="sig-paren">(</span>*updates\_to\_make: typing.Union\[bi\_etl.components.row.row.Row, dict\], key\_names: typing.Iterable = None, key\_values: typing.Iterable = None, lookup\_name: str = None, update\_all\_rows: bool = False, source\_excludes: typing.Iterable = None, target\_excludes: typing.Iterable = None, stat\_name: str = 'direct update', parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.update" class="headerlink" title="Permalink to this definition">¶</a>  
Directly performs a database update. Invalidates caching. If you have a full target row, use apply\_updates.

|             |                                                                                                                                                                                                                                                                                                                                 |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **updates\_to\_make** – Updates to make to the rows matching the criteria Can also be used to pass the key\_values, so you can pass a single `Row` or `dict` to the call and have it automatically get the filter values and updates from it.                                                                               
  -   **key\_names** – Optional. List of columns to apply criteria too (see `key_values`). Defaults to Primary Key columns.                                                                                                                                                                                                        
  -   **key\_values** – Optional. List of values to apply as criteria (see `key_names`). If not provided, and `update_all_rows` is False, look in `updates_to_make` for values.                                                                                                                                                    
  -   **lookup\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name of the lookup to use                                                                                                                                           
  -   **update\_all\_rows** – Optional. Defaults to False. If set to True, `key_names` and `key_values` are not required.                                                                                                                                                                                                          
  -   **source\_excludes** – Optional. list of `Row` source columns to exclude when mapping to this Table.                                                                                                                                                                                                                         
  -   **target\_excludes** – Optional. list of Table columns to exclude when mapping from the source `Row` (s)                                                                                                                                                                                                                     
  -   **stat\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – Name of this step for the ETLTask statistics. Default = ‘direct update’                                                                                               
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional. Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.  |

 `update_not_in_set`<span class="sig-paren">(</span>*updates\_to\_make*, *set\_of\_key\_tuples: set*, *lookup\_name: str = None*, *criteria: list = None*, *use\_cache\_as\_source: bool = True*, *source\_effective\_date: datetime.datetime = None*, *progress\_frequency: int = None*, *stat\_name: str = 'update\_not\_in\_set'*, *parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.update_not_in_set" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.update_not_in_set" class="headerlink" title="Permalink to this definition">¶</a>  
Applies update to rows matching criteria that are not in the list\_of\_key\_tuples pass in.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **updates\_to\_make** (<a href="#bi_etl.components.hst_table.HistoryTable.Row" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.Row"><code class="xref py py-class docutils literal">Row</code></a>) – Row or dict of updates to make                                                                                                                                                                                                                                                                                                                                                                                           
  -   **set\_of\_key\_tuples** (<a href="bi_etl.bi_config_parser.md#bi_etl.bi_config_parser.BIConfigParser.set" class="reference internal" title="bi_etl.bi_config_parser.BIConfigParser.set"><em>set</em></a>) – Set of tuples comprising the primary key values. This list represents the rows that should *not* be updated.                                                                                                                                                                                                                                                                                                                                 
  -   **lookup\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – The name of the lookup (see <a href="#bi_etl.components.hst_table.HistoryTable.define_lookup" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.define_lookup"><code class="xref py py-meth docutils literal">define_lookup()</code></a>) to use when searching for an existing row.                                                                                                                                                                                     
  -   **criteria** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a> *or* *list of strings*) – Only rows matching criteria will be checked against the `list_of_key_tuples` for deletion. Each string value will be passed to `sqlalchemy.sql.expression.Select.where()`. <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>  
  -   **use\_cache\_as\_source** (<a href="https://docs.python.org/2/library/functions.md#bool" class="reference external" title="(in Python v2.7)"><em>bool</em></a>) – Attempt to read existing rows from the cache?                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -   **source\_effective\_date** (<a href="https://docs.python.org/2/library/datetime.md#module-datetime" class="reference external" title="(in Python v2.7)"><em>datetime</em></a>) – The effective date to use for updates. Defaults to now().                                                                                                                                                                                                                                                                                                                                                                                                              
  -   **stat\_name** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a>) – Name of this step for the ETLTask statistics. Default = ‘delete\_not\_in\_set’                                                                                                                                                                                                                                                                                                                                                                                                            
  -   **progress\_frequency** (<a href="https://docs.python.org/2/library/functions.md#int" class="reference external" title="(in Python v2.7)"><em>int</em></a>) – How often (in seconds) to output progress messages. Default = 10. None for no progress messages.                                                                                                                                                                                                                                                                                                                                                                                           
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                                                                                                                                                                                                                                 |

 `update_not_processed`<span class="sig-paren">(</span>*update\_row*, *source\_effective\_date=None*, *criteria=None*, *use\_cache\_as\_source=True*, *stat\_name='update\_not\_processed'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.update_not_processed" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.update_not_processed" class="headerlink" title="Permalink to this definition">¶</a>  
Applies update to rows matching criteria that are not in the Table memory of rows passed to <a href="#bi_etl.components.hst_table.HistoryTable.upsert" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.upsert"><code class="xref py py-meth docutils literal">upsert()</code></a>.

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **update\_row** (`Row`) – Row or dict of updates to make                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -   **source\_effective\_date** (*date*) – Effective date of records to update                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  -   **criteria** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a> *or* *list of strings*) – Only rows matching criteria will be checked against the `list_of_key_tuples` for update. Each string value will be passed to `sqlalchemy.sql.expression.Select.where()`. <a href="http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where" class="uri" class="reference external">http://docs.sqlalchemy.org/en/rel_1_0/core/selectable.md?highlight=where#sqlalchemy.sql.expression.Select.where</a>  
  -   **use\_cache\_as\_source** (<a href="https://docs.python.org/2/library/functions.md#bool" class="reference external" title="(in Python v2.7)"><em>bool</em></a>) – Attempt to read existing rows from the cache?                                                                                                                                                                                                                                                                                                                                                                                                                                       
  -   **stat\_name** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a>) – Defaults to ‘update\_not\_processed’                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                                                                                                                                                                                                                               |

 `update_where_pk`<span class="sig-paren">(</span>*updates\_to\_make: typing.Union\[bi\_etl.components.row.row.Row, dict\], key\_values: typing.Union\[bi\_etl.components.row.row.Row, dict, list\] = None, source\_excludes: typing.Iterable = None, target\_excludes: typing.Iterable = None, stat\_name: str = 'update\_where\_pk', parent\_stats: bi\_etl.statistics.Statistics = None*<span class="sig-paren">)</span><a href="#bi_etl.components.hst_table.HistoryTable.update_where_pk" class="headerlink" title="Permalink to this definition">¶</a>  
Updates the table using the primary key for the where clause.

|             |                                                                                                                                                                                                                                                   |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **updates\_to\_make** – Updates to make to the rows matching the criteria Can also be used to pass the key\_values, so you can pass a single `Row` or `dict` to the call and have it automatically get the filter values and updates from it. 
  -   **key\_values** – Optional. dict or list of key to apply as criteria                                                                                                                                                                           
  -   **source\_excludes** – Optional. list of `Row` source columns to exclude when mapping to this Table.                                                                                                                                           
  -   **target\_excludes** – Optional. list of Table columns to exclude when mapping from the source `Row` (s)                                                                                                                                       
  -   **stat\_name** – Name of this step for the ETLTask statistics. Default = ‘upsert\_by\_pk’                                                                                                                                                      
  -   **parent\_stats** – Optional. Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                              |

 `upsert`<span class="sig-paren">(</span>*source\_row: typing.Union\[bi\_etl.components.row.row.Row, typing.List\[bi\_etl.components.row.row.Row\]\], lookup\_name: str = None, skip\_update\_check\_on: list = None, do\_not\_update: list = None, additional\_update\_values: dict = None, additional\_insert\_values: dict = None, update\_callback: typing.Callable\[\[list, bi\_etl.components.row.row.Row\], NoneType\] = None, insert\_callback: typing.Callable\[\[list, bi\_etl.components.row.row.Row\], NoneType\] = None, source\_excludes: list = None, target\_excludes: list = None, stat\_name: str = 'upsert', parent\_stats: bi\_etl.statistics.Statistics = None, \*\*kwargs*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.upsert" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.upsert" class="headerlink" title="Permalink to this definition">¶</a>  
Update (if changed) or Insert a row in the table. Returns the row found/inserted, with the auto-generated key (if that feature is enabled)

|             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **source\_row** (`Row`) – Row to upsert                                                                                                                                                                                                                                                                                                                                                                                                                                
  -   **kwargs** –                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      source\_effective\_date: datetime                                                                                                                                                                                                                                                                                                                                                                                                                                       
      Effective datetime of records to upsert. If None, get from the source\_row column named the same as self.begin\_date. Otherwise, use the current datetime.                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -   **lookup\_name** (<a href="https://docs.python.org/2/library/functions.md#str" class="reference external" title="(in Python v2.7)"><em>str</em></a>) – The name of the lookup (see <a href="#bi_etl.components.hst_table.HistoryTable.define_lookup" class="reference internal" title="bi_etl.components.hst_table.HistoryTable.define_lookup"><code class="xref py py-meth docutils literal">define_lookup()</code></a>) to use when searching for an existing row.  
  -   **skip\_update\_check\_on** (*list*) – List of column names to not compare old vs new for updates.                                                                                                                                                                                                                                                                                                                                                                      
  -   **do\_not\_update** (*list*) – List of columns to never update.                                                                                                                                                                                                                                                                                                                                                                                                         
  -   **additional\_update\_values** (<a href="https://docs.python.org/2/library/stdtypes.md#dict" class="reference external" title="(in Python v2.7)"><em>dict</em></a>) – Additional updates to apply when updating                                                                                                                                                                                                                                                       
  -   **additional\_insert\_values** (<a href="https://docs.python.org/2/library/stdtypes.md#dict" class="reference external" title="(in Python v2.7)"><em>dict</em></a>) – Additional values to set on each row when inserting.                                                                                                                                                                                                                                            
  -   **update\_callback** (*func*) – Function to pass updated rows to. Function should not modify row.                                                                                                                                                                                                                                                                                                                                                                       
  -   **insert\_callback** (*func*) – Function to pass inserted rows to. Function should not modify row.                                                                                                                                                                                                                                                                                                                                                                      
  -   **source\_excludes** (*list*) – list of source columns to exclude when mapping to this Table.                                                                                                                                                                                                                                                                                                                                                                           
  -   **target\_excludes** (*list*) – list of Table columns to exclude when mapping from the source row                                                                                                                                                                                                                                                                                                                                                                       
  -   **stat\_name** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a>) – Name of this step for the ETLTask statistics. Default = ‘upsert\_by\_pk’                                                                                                                                                                                                                               
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.                                                                                                                                              |

 `upsert_by_pk`<span class="sig-paren">(</span>*source\_row: bi\_etl.components.row.row.Row*, *stat\_name='upsert\_by\_pk'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.upsert_by_pk" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.upsert_by_pk" class="headerlink" title="Permalink to this definition">¶</a>  
Used by upsert\_special\_values\_rows to find and update rows by the full PK. Not expected to be useful outside of that.

|             |                                                                                                                                                                                                                                                                                                                                |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Parameters: | -   **source\_row** (`Row`) – Row to upsert                                                                                                                                                                                                                                                                                    
  -   **stat\_name** (<a href="https://docs.python.org/2/library/string.md#module-string" class="reference external" title="(in Python v2.7)"><em>string</em></a>) – Name of this step for the ETLTask statistics. Default = ‘upsert\_by\_pk’                                                                                   
  -   **parent\_stats** (<a href="bi_etl.statistics.md#bi_etl.statistics.Statistics" class="reference internal" title="bi_etl.statistics.Statistics"><em>bi_etl.statistics.Statistics</em></a>) – Optional Statistics object to nest this steps statistics in. Default is to place statistics in the ETLTask level statistics.  |

 `upsert_special_values_rows`<span class="sig-paren">(</span>*stat\_name='upsert\_special\_values\_rows'*, *parent\_stats=None*<span class="sig-paren">)</span><a href="_modules/bi_etl/components/hst_table.md#HistoryTable.upsert_special_values_rows" class="reference internal"><span class="viewcode-link">[source]</span></a><a href="#bi_etl.components.hst_table.HistoryTable.upsert_special_values_rows" class="headerlink" title="Permalink to this definition">¶</a>  

 `where`<span class="sig-paren">(</span>*criteria=None*, *order\_by=None*, *column\_list=None*, *exclude\_cols=None*, *use\_cache\_as\_source=None*, *progress\_frequency: int = None*, *stats\_id=None*, *parent\_stats=None*<span class="sig-paren">)</span> → typing.Iterable\[bi\_etl.components.row.row.Row\]<a href="#bi_etl.components.hst_table.HistoryTable.where" class="headerlink" title="Permalink to this definition">¶</a>  

#### Previous topic

[bi\_etl.components.etlcomponent module](bi_etl.components.etlcomponent.md "previous chapter")

#### Next topic

[bi\_etl.components.readonlytable module](bi_etl.components.readonlytable.md "next chapter")

### Quick search

### Navigation

-   [index](genindex.md "General Index")
-   [modules](py-modindex.md "Python Module Index") |
-   [next](bi_etl.components.readonlytable.md "bi_etl.components.readonlytable module") |
-   [previous](bi_etl.components.etlcomponent.md "bi_etl.components.etlcomponent module") |
-   [bi\_etl 0.5.3 documentation](index.md) »
-   [bi\_etl](modules.md) »
-   [bi\_etl package](bi_etl.md) »
-   [bi\_etl.components package](bi_etl.components.md) »

© Copyright 2015, Derek Wood. Created using [Sphinx](http://sphinx-doc.org/) 1.5.4.
